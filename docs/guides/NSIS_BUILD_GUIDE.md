# NSISå®‰è£…åŒ…æ„å»ºå®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•æ„å»ºå‘ˆå°šç­–åˆ’å·¥å…·ç®±çš„NSISå®‰è£…åŒ…ï¼ŒåŒ…æ‹¬ç¯å¢ƒé…ç½®ã€æ„å»ºæµç¨‹ã€æ•…éšœæ’é™¤å’Œåˆ†å‘ç­–ç•¥ã€‚

## ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹©NSIS

### NSIS vs MSI vs ç›´æ¥EXEå¯¹æ¯”

| ç‰¹æ€§ | ç›´æ¥EXE | MSI | NSIS |
|------|---------|-----|------|
| **ç”¨æˆ·ä½“éªŒ** | âš ï¸ ç®€å• | âœ… ä¸“ä¸š | âœ… **æœ€ä½³** |
| **ä¾èµ–æ£€æµ‹** | âŒ æ—  | âš ï¸ åŸºç¡€ | âœ… **æ™ºèƒ½** |
| **å®‰è£…å®šåˆ¶** | âŒ æ—  | âš ï¸ æœ‰é™ | âœ… **å®Œå…¨å¯å®šåˆ¶** |
| **é”™è¯¯å¤„ç†** | âŒ ç³»ç»Ÿçº§ | âš ï¸ åŸºç¡€ | âœ… **ç”¨æˆ·å‹å¥½** |
| **åˆ†å‘ä¾¿åˆ©** | âš ï¸ éœ€è¯´æ˜ | âœ… æ ‡å‡† | âœ… **æœ€ä½³** |
| **ä¼ä¸šéƒ¨ç½²** | âŒ å›°éš¾ | âœ… æ”¯æŒ | âœ… **å®Œå…¨æ”¯æŒ** |

### NSISçš„æ ¸å¿ƒä¼˜åŠ¿

1. **æ™ºèƒ½ä¾èµ–ç®¡ç†**
   - è‡ªåŠ¨æ£€æµ‹WebView2è¿è¡Œæ—¶
   - æä¾›æ¸…æ™°çš„å®‰è£…æŒ‡å¯¼
   - æ”¯æŒè‡ªåŠ¨ä¸‹è½½ä¾èµ–

2. **ä¸“ä¸šå®‰è£…ä½“éªŒ**
   - ç°ä»£åŒ–å®‰è£…ç•Œé¢
   - è¿›åº¦æ˜¾ç¤ºå’ŒçŠ¶æ€åé¦ˆ
   - å¤šè¯­è¨€æ”¯æŒ

3. **ä¼ä¸šçº§éƒ¨ç½²**
   - é™é»˜å®‰è£…æ”¯æŒ
   - æ‰¹é‡éƒ¨ç½²è„šæœ¬
   - ç»„ç­–ç•¥å…¼å®¹

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### å¼€å‘ç¯å¢ƒè¦æ±‚

```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # éœ€è¦ >= 18.0.0

# æ£€æŸ¥Rustç‰ˆæœ¬
rustc --version  # éœ€è¦ >= 1.70.0

# æ£€æŸ¥Tauri CLI
cargo tauri --version  # éœ€è¦ >= 2.0.0
```

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 (æ¨èåœ¨ç›®æ ‡å¹³å°æ„å»º)
- **å†…å­˜**: >= 4GB RAM
- **ç£ç›˜ç©ºé—´**: >= 5GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ (ä¸‹è½½ä¾èµ–)

## ğŸ“¦ æ„å»ºé…ç½®

### 1. Taurié…ç½®æ–‡ä»¶

é¡¹ç›®å·²é…ç½®ä¸ºé»˜è®¤ä½¿ç”¨NSISï¼Œé…ç½®ä½äº `src-tauri/tauri.conf.json`ï¼š

```json
{
  "bundle": {
    "active": true,
    "targets": ["nsis"],
    "publisher": "å‘ˆå°šç­–åˆ’",
    "category": "Productivity",
    "shortDescription": "å‘ˆå°šç­–åˆ’ä¸“ä¸šå·¥å…·é›†åˆ",
    "longDescription": "é›†æˆ19ä¸ªä¸“ä¸šå·¥å…·çš„æ¡Œé¢åº”ç”¨ï¼ŒæœåŠ¡äºè¿è¥ã€ç¾å·¥ã€é”€å”®ã€äººäº‹ã€å®¢æœç­‰ä¸åŒå²—ä½çš„å·¥ä½œéœ€æ±‚"
  }
}
```

### 2. é«˜çº§NSISé…ç½®

å¦‚éœ€è‡ªå®šä¹‰å®‰è£…è¡Œä¸ºï¼Œå¯æ·»åŠ NSISç‰¹å®šé…ç½®ï¼š

```json
{
  "bundle": {
    "nsis": {
      "displayLanguageSelector": false,
      "installerIcon": "icons/icon.ico",
      "installMode": "perMachine",
      "allowToChangeInstallationDirectory": true,
      "deleteAppDataOnUninstall": false,
      "shortcutName": "å‘ˆå°šç­–åˆ’å·¥å…·ç®±",
      "publisherName": "å‘ˆå°šç­–åˆ’",
      "installScript": "custom-install.nsh"
    }
  }
}
```

## ğŸš€ æ„å»ºæµç¨‹

### æ ‡å‡†æ„å»ºæµç¨‹

```bash
# 1. æ¸…ç†ä¹‹å‰çš„æ„å»º
cargo clean
rm -rf src-tauri/target/release/bundle

# 2. å®‰è£…/æ›´æ–°ä¾èµ–
pnpm install

# 3. æ‰§è¡Œå®Œæ•´æ„å»º
npm run tauri:build

# 4. éªŒè¯æ„å»ºç»“æœ
ls -la src-tauri/target/release/bundle/nsis/
```

### æ„å»ºè¿‡ç¨‹è¯¦è§£

#### é˜¶æ®µ1: å‰ç«¯æ„å»º
```bash
# Next.jsé™æ€ç«™ç‚¹ç”Ÿæˆ
npm run build
# è¾“å‡º: out/ ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶
```

#### é˜¶æ®µ2: Rustç¼–è¯‘
```bash
# Rustä»£ç ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶
cargo build --release
# è¾“å‡º: src-tauri/target/release/app.exe
```

#### é˜¶æ®µ3: NSISæ‰“åŒ…
```bash
# ä½¿ç”¨NSISåˆ›å»ºå®‰è£…ç¨‹åº
# è‡ªåŠ¨åŒ…å«: app.exe + é™æ€æ–‡ä»¶ + å›¾æ ‡ + é…ç½®
# è¾“å‡º: å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe
```

### æ„å»ºä¼˜åŒ–

#### å¹¶è¡Œæ„å»º
```bash
# è®¾ç½®å¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°
set CARGO_BUILD_JOBS=4
npm run tauri:build
```

#### å¢é‡æ„å»º
```bash
# å¼€å‘æ—¶ä½¿ç”¨å¢é‡æ„å»º
npm run tauri:dev
# ä»…åœ¨å‘å¸ƒæ—¶ä½¿ç”¨å®Œæ•´æ„å»º
npm run tauri:build
```

## ğŸ“Š æ„å»ºäº§ç‰©åˆ†æ

### æ–‡ä»¶ç»“æ„
```
src-tauri/target/release/
â”œâ”€â”€ app.exe                                    # ä¸»ç¨‹åº (15-25MB)
â”œâ”€â”€ bundle/
â”‚   â””â”€â”€ nsis/
â”‚       â””â”€â”€ å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe  # NSISå®‰è£…åŒ… (20-35MB)
â”œâ”€â”€ resources/                                 # åº”ç”¨èµ„æº
â”‚   â””â”€â”€ icon.ico
â””â”€â”€ deps/                                      # ä¾èµ–åº“æ–‡ä»¶
```

### å¤§å°åˆ†æ
- **app.exe**: 15-25MB (åŒ…å«Rustè¿è¡Œæ—¶ + WebView2ç»‘å®š)
- **NSISå®‰è£…åŒ…**: 20-35MB (åŒ…å«app.exe + é™æ€æ–‡ä»¶ + å®‰è£…é€»è¾‘)
- **å‹ç¼©ç‡**: çº¦15-20% (NSISå†…ç½®å‹ç¼©)

## ğŸ” è´¨é‡æ£€æŸ¥

### è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬

åˆ›å»º `scripts/verify-build.bat`ï¼š

```batch
@echo off
echo ================================
echo NSISå®‰è£…åŒ…è´¨é‡æ£€æŸ¥
echo ================================

set NSIS_FILE=src-tauri\target\release\bundle\nsis\å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe

if not exist "%NSIS_FILE%" (
    echo âŒ é”™è¯¯: NSISå®‰è£…åŒ…ä¸å­˜åœ¨
    exit /b 1
)

echo âœ… å®‰è£…åŒ…æ–‡ä»¶å­˜åœ¨
for %%A in ("%NSIS_FILE%") do echo æ–‡ä»¶å¤§å°: %%~zA å­—èŠ‚

echo.
echo ğŸ” æ‰§è¡ŒåŸºç¡€æ£€æŸ¥...

# æ£€æŸ¥æ–‡ä»¶ç­¾å (å¦‚æœæœ‰)
signtool verify /pa "%NSIS_FILE%" 2>nul
if %errorlevel% equ 0 (
    echo âœ… æ•°å­—ç­¾åéªŒè¯é€šè¿‡
) else (
    echo âš ï¸ æœªæ£€æµ‹åˆ°æ•°å­—ç­¾å
)

echo.
echo ğŸ“‹ å»ºè®®æ‰‹åŠ¨æµ‹è¯•:
echo 1. åœ¨è™šæ‹Ÿæœºä¸­æµ‹è¯•å®‰è£…
echo 2. éªŒè¯å¿«æ·æ–¹å¼åˆ›å»º
echo 3. æµ‹è¯•åº”ç”¨å¯åŠ¨
echo 4. éªŒè¯å¸è½½åŠŸèƒ½

pause
```

### æ‰‹åŠ¨æ£€æŸ¥æ¸…å•

#### âœ… æ–‡ä»¶å®Œæ•´æ€§
- [ ] NSISå®‰è£…åŒ…å·²ç”Ÿæˆ
- [ ] æ–‡ä»¶å¤§å°åœ¨åˆç†èŒƒå›´ (20-35MB)
- [ ] æ–‡ä»¶ååŒ…å«æ­£ç¡®ç‰ˆæœ¬å·
- [ ] å›¾æ ‡æ˜¾ç¤ºæ­£ç¡®

#### âœ… å®‰è£…æµ‹è¯•
- [ ] å®‰è£…ç¨‹åºå¯ä»¥å¯åŠ¨
- [ ] å®‰è£…è¿‡ç¨‹æ— é”™è¯¯
- [ ] è¿›åº¦æ˜¾ç¤ºæ­£å¸¸
- [ ] å®‰è£…è·¯å¾„å¯é€‰æ‹©

#### âœ… åŠŸèƒ½æµ‹è¯•
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] æ‰€æœ‰19ä¸ªå·¥å…·å¯è®¿é—®
- [ ] WebViewåŠŸèƒ½æ­£å¸¸
- [ ] å¿«æ·æ–¹å¼å·¥ä½œæ­£å¸¸

#### âœ… å¸è½½æµ‹è¯•
- [ ] å¸è½½ç¨‹åºå­˜åœ¨
- [ ] å¸è½½è¿‡ç¨‹å®Œæ•´
- [ ] æ–‡ä»¶æ¸…ç†å¹²å‡€
- [ ] æ³¨å†Œè¡¨æ¸…ç†æ­£ç¡®

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§æ„å»ºé—®é¢˜

#### é—®é¢˜1: "failed to bundle project"
```bash
# è§£å†³æ–¹æ¡ˆ:
# 1. æ¸…ç†æ„å»ºç¼“å­˜
cargo clean
rm -rf src-tauri/target

# 2. æ›´æ–°å·¥å…·é“¾
rustup update
cargo install tauri-cli --locked

# 3. é‡æ–°æ„å»º
npm run tauri:build
```

#### é—®é¢˜2: "NSIS compiler not found"
```bash
# Windowsç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½NSIS
# å¦‚æœå¤±è´¥ï¼Œæ‰‹åŠ¨å®‰è£…:
# 1. ä¸‹è½½ NSIS 3.08+ from https://nsis.sourceforge.io/
# 2. å®‰è£…åˆ°é»˜è®¤è·¯å¾„
# 3. é‡æ–°è¿è¡Œæ„å»º
```

#### é—®é¢˜3: æ„å»ºæˆåŠŸä½†å®‰è£…åŒ…æ— æ³•è¿è¡Œ
```bash
# æ£€æŸ¥æ­¥éª¤:
# 1. éªŒè¯ç›®æ ‡ç³»ç»Ÿæ¶æ„ (éœ€è¦64ä½)
# 2. æ£€æŸ¥WebView2ä¾èµ–
# 3. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
# 4. æ£€æŸ¥é˜²ç—…æ¯’è½¯ä»¶è¯¯æŠ¥
```

### æ€§èƒ½é—®é¢˜

#### æ„å»ºé€Ÿåº¦æ…¢
```bash
# ä¼˜åŒ–æ–¹æ¡ˆ:
# 1. ä½¿ç”¨SSDå­˜å‚¨
# 2. å¢åŠ å†…å­˜
# 3. å¯ç”¨å¹¶è¡Œç¼–è¯‘
set CARGO_BUILD_JOBS=8

# 4. ä½¿ç”¨æœ¬åœ°ç¼“å­˜
set CARGO_TARGET_DIR=D:\cache\target
```

#### å®‰è£…åŒ…è¿‡å¤§
```bash
# åˆ†æå’Œä¼˜åŒ–:
# 1. æ£€æŸ¥é™æ€æ–‡ä»¶å¤§å°
du -sh out/

# 2. ä¼˜åŒ–å›¾ç‰‡èµ„æº
# 3. ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ–
# 4. å¯ç”¨æ›´é«˜å‹ç¼©çº§åˆ« (åœ¨NSISé…ç½®ä¸­)
```

## ğŸ“‹ åˆ†å‘ç­–ç•¥

### åˆ†å‘æ–‡ä»¶å‡†å¤‡

```
åˆ†å‘åŒ…/
â”œâ”€â”€ å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe    # ä¸»å®‰è£…åŒ…
â”œâ”€â”€ å®‰è£…è¯´æ˜.txt                           # ç”¨æˆ·æŒ‡å—
â”œâ”€â”€ ç³»ç»Ÿè¦æ±‚.txt                           # å…¼å®¹æ€§è¯´æ˜
â””â”€â”€ æ•…éšœæ’é™¤.txt                           # å¸¸è§é—®é¢˜è§£å†³
```

### ç”¨æˆ·æŒ‡å—æ¨¡æ¿

åˆ›å»º `å®‰è£…è¯´æ˜.txt`ï¼š

```
å‘ˆå°šç­–åˆ’å·¥å…·ç®± - å®‰è£…æŒ‡å—

ç³»ç»Ÿè¦æ±‚:
- Windows 10/11 (64ä½)
- 4GB+ å†…å­˜
- 500MB+ ç£ç›˜ç©ºé—´
- ç½‘ç»œè¿æ¥

å®‰è£…æ­¥éª¤:
1. åŒå‡» "å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe"
2. æŒ‰ç…§å®‰è£…å‘å¯¼æç¤ºæ“ä½œ
3. é€‰æ‹©å®‰è£…è·¯å¾„ (å¯é€‰)
4. ç­‰å¾…å®‰è£…å®Œæˆ
5. å¯åŠ¨åº”ç”¨

å¦‚æœé‡åˆ°é—®é¢˜:
1. ç¡®ä¿ç³»ç»Ÿä¸ºWindows 10/11 64ä½
2. å®‰è£…WebView2è¿è¡Œæ—¶: https://developer.microsoft.com/microsoft-edge/webview2/
3. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå®‰è£…åŒ…
4. è”ç³»æŠ€æœ¯æ”¯æŒ

æŠ€æœ¯æ”¯æŒ: support@chengshangcehua.com
```

### ä¼ä¸šéƒ¨ç½²

#### é™é»˜å®‰è£…
```batch
# é™é»˜å®‰è£…å‘½ä»¤
"å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe" /S

# æŒ‡å®šå®‰è£…è·¯å¾„
"å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe" /S /D=C:\Program Files\ChengShangCeHua
```

#### æ‰¹é‡éƒ¨ç½²è„šæœ¬
```batch
@echo off
echo å‘ˆå°šç­–åˆ’å·¥å…·ç®± - æ‰¹é‡éƒ¨ç½²è„šæœ¬

# æ£€æŸ¥ç®¡ç†å‘˜æƒé™
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo é”™è¯¯: éœ€è¦ç®¡ç†å‘˜æƒé™
    pause
    exit /b 1
)

# æ‰§è¡Œé™é»˜å®‰è£…
echo æ­£åœ¨å®‰è£…å‘ˆå°šç­–åˆ’å·¥å…·ç®±...
"å‘ˆå°šç­–åˆ’é¡¹ç›®å±•ç¤º_1.0.0_x64-setup.exe" /S

if %errorlevel% equ 0 (
    echo âœ… å®‰è£…æˆåŠŸå®Œæˆ
) else (
    echo âŒ å®‰è£…å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %errorlevel%
)

pause
```

## ğŸ“ˆ ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬å·æ›´æ–°

æ›´æ–°ç‰ˆæœ¬æ—¶éœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **package.json**
```json
{
  "version": "1.1.0"
}
```

2. **src-tauri/tauri.conf.json**
```json
{
  "version": "1.1.0"
}
```

3. **src-tauri/Cargo.toml**
```toml
[package]
version = "1.1.0"
```

### è‡ªåŠ¨åŒ–ç‰ˆæœ¬æ›´æ–°è„šæœ¬

åˆ›å»º `scripts/update-version.js`ï¼š

```javascript
const fs = require('fs');
const path = require('path');

const newVersion = process.argv[2];
if (!newVersion) {
    console.error('è¯·æä¾›æ–°ç‰ˆæœ¬å·: node update-version.js 1.1.0');
    process.exit(1);
}

// æ›´æ–° package.json
const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'));
packageJson.version = newVersion;
fs.writeFileSync('package.json', JSON.stringify(packageJson, null, 2));

// æ›´æ–° tauri.conf.json
const tauriConf = JSON.parse(fs.readFileSync('src-tauri/tauri.conf.json', 'utf8'));
tauriConf.version = newVersion;
fs.writeFileSync('src-tauri/tauri.conf.json', JSON.stringify(tauriConf, null, 2));

// æ›´æ–° Cargo.toml
let cargoToml = fs.readFileSync('src-tauri/Cargo.toml', 'utf8');
cargoToml = cargoToml.replace(/version = "[\d\.]+"/, `version = "${newVersion}"`);
fs.writeFileSync('src-tauri/Cargo.toml', cargoToml);

console.log(`âœ… ç‰ˆæœ¬å·²æ›´æ–°ä¸º ${newVersion}`);
```

## ğŸ¯ æœ€ä½³å®è·µ

### æ„å»ºå‰æ£€æŸ¥
1. ç¡®ä¿æ‰€æœ‰ä»£ç å·²æäº¤
2. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
3. æ›´æ–°ç‰ˆæœ¬å·
4. æ›´æ–°CHANGELOG

### æ„å»ºè¿‡ç¨‹
1. ä½¿ç”¨å¹²å‡€çš„ç¯å¢ƒ
2. è®°å½•æ„å»ºæ—¥å¿—
3. éªŒè¯æ„å»ºäº§ç‰©
4. æ‰§è¡Œè´¨é‡æ£€æŸ¥

### å‘å¸ƒå
1. åœ¨å¤šä¸ªç¯å¢ƒæµ‹è¯•
2. æ”¶é›†ç”¨æˆ·åé¦ˆ
3. ç›‘æ§å®‰è£…æˆåŠŸç‡
4. å‡†å¤‡çƒ­ä¿®å¤æ–¹æ¡ˆ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨NSISæ„å»ºè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ„å»ºæ—¥å¿—
2. æ£€æŸ¥ç¯å¢ƒé…ç½®
3. å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†
4. è”ç³»å¼€å‘å›¢é˜Ÿ

**è”ç³»æ–¹å¼**: support@chengshangcehua.com
