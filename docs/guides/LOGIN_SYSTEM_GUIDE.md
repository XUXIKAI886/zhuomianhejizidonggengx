# 🔐 登录系统完整使用指南

## 📋 概述

呈尚策划工具箱 v1.0.16 集成了完整的用户认证系统，支持跨设备登录、权限管理和使用统计分析。本指南将详细介绍登录系统的使用方法和技术实现。

## 🚀 快速开始

### 1. 启动应用
```bash
npm run tauri dev
```

### 2. 登录系统
应用启动后会自动跳转到登录页面，使用以下预设账号：

| 角色 | 用户名 | 密码 | 权限 |
|------|--------|------|------|
| **管理员** | `admin` | `admin@2025csch` | 完整系统管理权限 |
| **测试用户** | `testuser` | `test123456` | 普通用户权限 |

### 3. 功能访问
- **普通用户**：登录后可使用所有工具功能
- **管理员**：额外可访问后台管理系统（点击用户头像 → 后台管理）

## 🏗️ 系统架构

### 前端架构
```
├── lib/auth/
│   ├── auth-context.tsx     # 全局认证状态管理
│   └── auth-guard.tsx       # 路由保护组件
├── app/login/
│   └── page.tsx            # 登录页面
├── app/admin/
│   └── page.tsx            # 管理员后台
├── components/
│   └── header.tsx          # 用户信息显示
└── lib/
    └── tauri-api.ts        # API调用包装器
```

### 后端架构
```
src-tauri/src/
├── auth.rs                 # 认证逻辑实现
├── lib.rs                  # Tauri命令注册
└── main.rs                 # 应用入口
```

## 🔧 核心功能

### 1. 用户认证
- **安全登录**：SHA256密码加密存储
- **会话管理**：自动登录和记住密码功能
- **权限控制**：基于角色的访问控制
- **跨设备支持**：MongoDB云数据库同步

### 2. 管理员后台
- **用户管理**：查看、编辑、删除用户账号
- **权限控制**：启用/禁用用户账号
- **系统统计**：用户活跃度、登录统计
- **工具分析**：工具使用排行和分析

### 3. 使用统计
- **行为追踪**：记录用户操作和工具使用
- **会话管理**：登录时间、会话时长统计
- **数据可视化**：图表展示使用趋势

## 🛠️ 开发模式

### 智能环境检测
系统会自动检测运行环境：
- **Tauri环境**：使用真实的后端API
- **开发环境**：自动回退到模拟数据

### 调试功能
- **详细日志**：控制台显示完整的认证流程
- **模拟数据**：离线开发和测试支持
- **错误提示**：友好的错误信息和解决建议

## 📊 数据库结构

### users 集合
```javascript
{
  username: "admin",
  password: "sha256_hash",
  role: "admin", // "admin" | "user"
  isActive: true,
  createdAt: ISODate(),
  lastLoginAt: ISODate(),
  totalUsageTime: 3600,
  loginCount: 5
}
```

### user_sessions 集合
```javascript
{
  userId: ObjectId(),
  loginAt: ISODate(),
  logoutAt: ISODate(),
  sessionDuration: 3600
}
```

### tool_usage 集合
```javascript
{
  userId: ObjectId(),
  toolId: 1,
  toolName: "AI写作助手",
  clickCount: 150,
  totalUsageTime: 7200,
  lastUsedAt: ISODate()
}
```

## 🚨 故障排除

### 常见问题

#### 1. 登录失败
**症状**：输入正确账号密码但无法登录
**解决方案**：
- 检查控制台日志确认错误信息
- 确认使用正确的预设账号
- 开发模式会自动使用模拟登录

#### 2. 管理后台无法访问
**症状**：点击"后台管理"没有反应
**解决方案**：
- 确认使用管理员账号登录
- 检查用户角色是否为 "admin"
- 查看控制台是否有权限错误

#### 3. 数据库连接失败
**症状**：真实环境下无法连接MongoDB
**解决方案**：
- 检查网络连接
- 确认MongoDB服务器可访问
- 开发模式会自动回退到模拟数据

### 调试技巧

1. **查看控制台**：开发模式提供详细的调试信息
2. **检查网络**：使用浏览器开发者工具监控请求
3. **验证状态**：检查认证状态和用户信息
4. **测试模拟**：使用预设账号测试功能

## 🔒 安全特性

### 密码安全
- **SHA256加密**：密码使用SHA256+盐值加密存储
- **不可逆加密**：原始密码无法从数据库中恢复
- **安全传输**：密码在传输过程中进行加密

### 会话安全
- **会话管理**：安全的用户会话追踪
- **自动过期**：长时间不活动自动退出
- **状态同步**：前后端状态实时同步

### 权限控制
- **角色区分**：管理员和普通用户权限分离
- **路由保护**：敏感页面需要相应权限
- **API保护**：后端接口进行权限验证

## 📈 使用统计

### 数据收集
- **登录记录**：记录每次登录时间和设备
- **工具使用**：统计工具点击次数和使用时长
- **会话分析**：分析用户活跃时间和使用模式

### 数据展示
- **管理员仪表板**：实时显示系统统计
- **用户排行**：最活跃用户和使用时长
- **工具分析**：最受欢迎的工具和功能

## 🎯 最佳实践

### 开发建议
1. **环境隔离**：开发和生产环境使用不同配置
2. **错误处理**：完善的异常处理和用户反馈
3. **性能优化**：合理使用缓存和懒加载
4. **安全考虑**：定期更新密码和权限审查

### 用户建议
1. **密码安全**：使用强密码并定期更换
2. **及时退出**：使用完毕及时退出登录
3. **权限管理**：管理员定期审查用户权限
4. **数据备份**：重要数据定期备份

## 📞 技术支持

如果在使用过程中遇到问题，请：
1. 查看本指南的故障排除部分
2. 检查控制台日志获取详细错误信息
3. 确认使用最新版本的应用
4. 联系技术支持团队

---

**版本信息**：v1.0.16  
**更新时间**：2025年1月  
**技术栈**：Tauri + Next.js + MongoDB + React
