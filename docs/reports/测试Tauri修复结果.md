# ğŸ”§ Tauri IPCä¿®å¤éªŒè¯æŒ‡å—

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. å¢å¼ºçš„ç¯å¢ƒæ£€æµ‹
- æ”¹è¿›äº†`isTauriEnvironment()`å‡½æ•°ï¼Œå¢åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- æ£€æµ‹å¤šç§Tauri APIä½ç½®ï¼š`__TAURI__`, `__TAURI_IPC__`, `invoke`
- æ£€æµ‹UserAgentä¸­çš„Tauriæ ‡è¯†

### 2. æ™ºèƒ½APIå›é€€æœºåˆ¶
- **ç¬¬ä¸€ä¼˜å…ˆçº§**: Tauriåç«¯APIï¼ˆå¦‚æœå¯ç”¨ï¼‰
- **å›é€€æœºåˆ¶**: å¦‚æœTauriä¸å¯ç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨Next.js API
- **æ•°æ®æºä¸€è‡´**: ä¸¤ç§æ–¹å¼éƒ½è®¿é—®ç›¸åŒçš„çœŸå®MongoDBæ•°æ®åº“

### 3. é…ç½®ä¼˜åŒ–
- å¯ç”¨äº†å¼€å‘è€…æ§åˆ¶å°ï¼š`"enableDeveloperConsole": true`
- CSPé…ç½®ä¼˜åŒ–ï¼Œç¡®ä¿APIè°ƒç”¨ä¸è¢«é˜»æ­¢

### 4. APIæµ‹è¯•éªŒè¯
- âœ… Next.js APIå·¥ä½œæ­£å¸¸
- âœ… ç™»å½•APIè¿”å›çœŸå®ç”¨æˆ·æ•°æ®
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸

## ğŸš€ ç°åœ¨è¿›è¡Œæœ€ç»ˆæµ‹è¯•

### æ­¥éª¤1: é‡æ–°å¯åŠ¨æ¡Œé¢åº”ç”¨

```bash
# åœæ­¢å½“å‰çš„tauri:devè¿›ç¨‹(å¦‚æœåœ¨è¿è¡Œ)
# ç„¶åé‡æ–°å¯åŠ¨
npm run tauri:dev
```

### æ­¥éª¤2: æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—

åœ¨æµè§ˆå™¨/åº”ç”¨çš„å¼€å‘è€…æ§åˆ¶å°ä¸­ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ” Tauriç¯å¢ƒæ£€æµ‹: {
  hasTauriGlobal: true/false,
  hasTauriUserAgent: true/false, 
  hasInvokeFunction: true/false,
  finalResult: true/false,
  userAgent: "...",
  availableGlobals: [...]
}
```

### æ­¥éª¤3: ç™»å½•æµ‹è¯•

ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼š
- **ç”¨æˆ·å**: admin
- **å¯†ç **: admin@2025csch

#### é¢„æœŸçš„æ§åˆ¶å°æ—¥å¿—ï¼š

**æƒ…å†µA: Tauri APIå¯ç”¨**
```
ğŸ”— API Call: login {username: 'admin', password: 'admin@2025csch', ...}
ğŸ“± Using Tauri backend for: login
âœ… Tauri success for login: {user data}
```

**æƒ…å†µB: Tauri APIä¸å¯ç”¨ï¼Œä½¿ç”¨å›é€€**
```
ğŸ”— API Call: login {username: 'admin', password: 'admin@2025csch', ...}
ğŸ“± Using Tauri backend for: login
âŒ Tauri failed for login: Error: ...
ğŸ”„ Falling back to Next.js API for: login
ğŸŒ Using Next.js API for: login
âœ… Next.js API success for login: {user data}
```

**æƒ…å†µC: éTauriç¯å¢ƒ**
```
ğŸ”— API Call: login {username: 'admin', password: 'admin@2025csch', ...}
ğŸŒ Not in Tauri environment, using Next.js API for: login
âœ… Next.js API success for login: {user data}
```

### æ­¥éª¤4: éªŒè¯ç™»å½•æˆåŠŸ

æ— è®ºä½¿ç”¨å“ªç§APIæ–¹å¼ï¼Œç™»å½•æˆåŠŸåä½ åº”è¯¥çœ‹åˆ°ï¼š
- âœ… ç™»å½•æˆåŠŸæç¤º
- âœ… è·³è½¬åˆ°ä¸»ç•Œé¢
- âœ… èƒ½å¤Ÿè®¿é—®ç®¡ç†åå°
- âœ… æ˜¾ç¤ºçœŸå®çš„ç”¨æˆ·æ•°æ®ï¼ˆä¸æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼‰

## ğŸ¯ ä¿®å¤è¯´æ˜

### é—®é¢˜åŸå› 
åŸå§‹é”™è¯¯ `Tauri invoke not available` çš„åŸå› ï¼š
1. **Tauri IPCåˆå§‹åŒ–é—®é¢˜**: åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒTauriçš„APIå¯¹è±¡å¯èƒ½æœªæ­£ç¡®åˆå§‹åŒ–
2. **ç¯å¢ƒæ£€æµ‹ä¸å‡†ç¡®**: åŸå…ˆçš„æ£€æµ‹é€»è¾‘å¯èƒ½è¯¯åˆ¤ç¯å¢ƒ
3. **ç¼ºå°‘å›é€€æœºåˆ¶**: å½“Tauriä¸å¯ç”¨æ—¶ï¼Œæ²¡æœ‰å¤‡é€‰æ–¹æ¡ˆ

### è§£å†³æ–¹æ¡ˆ
1. **å¢å¼ºç¯å¢ƒæ£€æµ‹**: å¤šé‡æ£€æµ‹æœºåˆ¶ç¡®ä¿å‡†ç¡®è¯†åˆ«Tauriç¯å¢ƒ
2. **æ™ºèƒ½å›é€€ç³»ç»Ÿ**: å½“Tauri APIå¤±è´¥æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨Next.js API
3. **ç»Ÿä¸€æ•°æ®æº**: æ— è®ºä½¿ç”¨å“ªç§APIï¼Œéƒ½è®¿é—®ç›¸åŒçš„çœŸå®MongoDBæ•°æ®åº“
4. **è¯¦ç»†æ—¥å¿—**: æä¾›å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¾¿äºé—®é¢˜è¯Šæ–­

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœä»ç„¶æ— æ³•ç™»å½•ï¼š

1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   ping dbconn.sealosbja.site
   ```

2. **æ£€æŸ¥Next.js APIæœåŠ¡å™¨**
   ```bash
   curl -X POST http://localhost:3001/api/auth/login/ \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin@2025csch"}'
   ```

3. **æ£€æŸ¥æ§åˆ¶å°é”™è¯¯**: æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Consoleå’ŒNetworkæ ‡ç­¾

4. **é‡å»ºåº”ç”¨**ï¼ˆå¦‚æœéœ€è¦ï¼‰:
   ```bash
   npm run build
   npm run tauri:dev
   ```

## ğŸ‰ æˆåŠŸæ ‡å¿—

ä¿®å¤æˆåŠŸçš„æ ‡å¿—ï¼š
- [x] å¯ä»¥æˆåŠŸç™»å½•ï¼ˆæ— è®ºä½¿ç”¨Tauriè¿˜æ˜¯Next.js APIï¼‰
- [x] ç®¡ç†åå°æ˜¾ç¤ºçœŸå®æ•°æ®
- [x] ç”¨æˆ·æ“ä½œå¯ä»¥æ­£å¸¸æ‰§è¡Œ
- [x] æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„APIè°ƒç”¨æ—¥å¿—
- [x] ä¸å†å‡ºç°"Tauri invoke not available"é”™è¯¯

## ğŸ’¡ æŠ€æœ¯è¯´æ˜

ç°åœ¨çš„ç³»ç»Ÿå…·æœ‰**åŒé‡ä¿éšœ**ï¼š
1. **æ¡Œé¢ä¼˜å…ˆ**: åœ¨Tauriç¯å¢ƒä¸­ä¼˜å…ˆä½¿ç”¨Ruståç«¯
2. **Webå…¼å®¹**: åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥ä½¿ç”¨Next.js APIä½œä¸ºå¤‡é€‰
3. **æ•°æ®ä¸€è‡´**: ä¸¤ç§æ–¹å¼è®¿é—®åŒä¸€ä¸ªMongoDBæ•°æ®åº“
4. **æ— ç¼åˆ‡æ¢**: ç”¨æˆ·æ— æ„ŸçŸ¥çš„APIåˆ‡æ¢æœºåˆ¶

è¿™ç¡®ä¿äº†åº”ç”¨åœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼