# å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†æ ¹æ®å·¥å…·ç±»å‹ (`toolType`) è‡ªåŠ¨é€‰æ‹©æ‰“å¼€æ–¹å¼ï¼š
- `toolType: "web"` - åœ¨ Tauri åº”ç”¨å†…çš„ WebView ä¸­æ‰“å¼€
- `toolType: "external"` - åœ¨ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€
- `toolType: "desktop"` - æ¡Œé¢åº”ç”¨ç±»å‹ï¼ˆä¿ç•™ï¼‰

## ğŸ¯ é€‚ç”¨åœºæ™¯

### ä½¿ç”¨å¤–éƒ¨æµè§ˆå™¨ (`external`) çš„æƒ…å†µ

**é€‚ç”¨äºéœ€è¦ä»¥ä¸‹åŠŸèƒ½çš„å·¥å…·**ï¼š
1. âœ… æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ - éœ€è¦æµè§ˆå™¨åŸç”Ÿæ–‡ä»¶API
2. âœ… è·¨åŸŸèµ„æºè®¿é—® - é¿å…Tauriçš„è·¨åŸŸé™åˆ¶
3. âœ… æµè§ˆå™¨æ’ä»¶ä¾èµ– - éœ€è¦ä½¿ç”¨æµè§ˆå™¨æ‰©å±•
4. âœ… å¤æ‚çš„JavaScriptåŠŸèƒ½ - å¯èƒ½ä¸Tauriç¯å¢ƒä¸å…¼å®¹
5. âœ… ç¬¬ä¸‰æ–¹è®¤è¯é›†æˆ - OAuthã€ç¤¾äº¤ç™»å½•ç­‰

**å…¸å‹å·¥å…·ç¤ºä¾‹**ï¼š
- å¤–å–å›¾ç‰‡ç³»ç»Ÿ (éœ€è¦æœ¬åœ°æ–‡ä»¶é€‰æ‹©å’Œå›¾ç‰‡ä¸‹è½½)
- å¤–å–æ•°å‘¨æŠ¥ç³»ç»Ÿ (å¯èƒ½éœ€è¦å¯¼å‡ºåŠŸèƒ½)

### ä½¿ç”¨åº”ç”¨å†…WebView (`web`) çš„æƒ…å†µ

**é€‚ç”¨äºä»¥ä¸‹ç±»å‹çš„å·¥å…·**ï¼š
1. âœ… çº¯å±•ç¤ºå‹å·¥å…· - è¿è¥æ‰‹å†Œã€çŸ¥è¯†åº“
2. âœ… æ•°æ®å¯è§†åŒ– - å›¾è¡¨å±•ç¤ºã€æ•°æ®åˆ†æ
3. âœ… ç®€å•äº¤äº’å·¥å…· - è®¡ç®—å™¨ã€ç»Ÿè®¡å·¥å…·
4. âœ… å†…éƒ¨ç®¡ç†ç³»ç»Ÿ - å·²é›†æˆè®¤è¯çš„å†…éƒ¨å·¥å…·

**ä¼˜ç‚¹**ï¼š
- ç»Ÿä¸€çš„ç”¨æˆ·ä½“éªŒ
- æ— éœ€åˆ‡æ¢çª—å£
- å¯ä»¥å…±äº«åº”ç”¨è®¤è¯çŠ¶æ€

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. å·¥å…·æ•°æ®é…ç½®

åœ¨ `lib/tool-data.ts` ä¸­æ ‡è®°å·¥å…·ç±»å‹ï¼š

```typescript
{
  id: 33,
  name: "å¤–å–å›¾ç‰‡ç³»ç»Ÿ",
  description: "å¤–å–å¤´åƒã€åº—æ‹›ã€æµ·æŠ¥å›¾ç‰‡æå–å’Œå¤„ç†å·¥å…·",
  category: "ç¾å·¥å·¥å…·",
  url: "https://xuxikai886.github.io/touxiangdianzhaohaibaotiqu/",
  icon: Image,
  toolType: "external"  // â† æ ‡è®°ä¸ºå¤–éƒ¨æ‰“å¼€
}
```

### 2. ç‚¹å‡»å¤„ç†é€»è¾‘

åœ¨ `components/tool-grid.tsx` ä¸­çš„ `handleLaunchTool` å‡½æ•°ï¼š

```typescript
const handleLaunchTool = async (tool) => {
  // ... ç»Ÿè®¡è®°å½•ä»£ç  ...

  if (tool.toolType === 'external') {
    // åœ¨å¤–éƒ¨æµè§ˆå™¨ä¸­æ‰“å¼€
    if (typeof window.__TAURI__ !== 'undefined') {
      // Tauriç¯å¢ƒ - ä½¿ç”¨shellæ’ä»¶
      await window.__TAURI__.core.invoke('plugin:shell|open', {
        path: tool.url
      })
    } else {
      // Webç¯å¢ƒ - ä½¿ç”¨window.open
      window.open(tool.url, '_blank')
    }
  } else {
    // åœ¨åº”ç”¨å†…WebViewä¸­æ‰“å¼€
    setWebViewModal({
      isOpen: true,
      tool: tool
    })
  }
}
```

### 3. Tauriæƒé™é…ç½®

åœ¨ `src-tauri/capabilities/main-capability.json` ä¸­é…ç½®shellæƒé™ï¼š

```json
{
  "identifier": "shell:allow-open",
  "allow": [
    {
      "name": "open",
      "cmd": {
        "args": [
          { "validator": "https://xuxikai886.github.io/**" },
          { "validator": "https://www.yujinkeji.xyz/**" },
          { "validator": "https://**" },
          { "validator": "http://**" }
        ]
      }
    }
  ]
}
```

## ğŸ“Š å½“å‰é…ç½®çš„å¤–éƒ¨å·¥å…·

| å·¥å…·ID | å·¥å…·åç§° | URL | åŸå›  |
|--------|---------|-----|------|
| 33 | å¤–å–å›¾ç‰‡ç³»ç»Ÿ | https://xuxikai886.github.io/touxiangdianzhaohaibaotiqu/ | éœ€è¦æ–‡ä»¶é€‰æ‹©å’Œä¸‹è½½åŠŸèƒ½ |
| 23 | å¤–å–æ•°å‘¨æŠ¥ç³»ç»Ÿ | https://www.csch.asia/ | å¯èƒ½éœ€è¦å¯¼å‡ºåŠŸèƒ½ |

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€

1. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**ï¼š
   ```bash
   npm run tauri:dev
   ```

2. **æ‰¾åˆ°æ ‡è®°ä¸º `external` çš„å·¥å…·**ï¼š
   - è¿›å…¥"ç¾å·¥å·¥å…·"åˆ†ç±»
   - æ‰¾åˆ°"å¤–å–å›¾ç‰‡ç³»ç»Ÿ"

3. **ç‚¹å‡»"æ‰“å¼€å·¥å…·"æŒ‰é’®**ï¼š
   - âœ… åº”è¯¥åœ¨ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€ï¼ˆChrome/Edge/Firefoxç­‰ï¼‰
   - âœ… ä¸åº”è¯¥åœ¨Tauriåº”ç”¨å†…çš„WebViewä¸­æ‰“å¼€

4. **éªŒè¯åŠŸèƒ½**ï¼š
   - âœ… åœ¨æµè§ˆå™¨ä¸­å¯ä»¥æ­£å¸¸é€‰æ‹©æ–‡ä»¶
   - âœ… åœ¨æµè§ˆå™¨ä¸­å¯ä»¥æ­£å¸¸ä¸‹è½½å›¾ç‰‡
   - âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### æµ‹è¯•åº”ç”¨å†…WebView

1. **æ‰¾åˆ°æ ‡è®°ä¸º `web` çš„å·¥å…·**ï¼š
   - è¿›å…¥"è¿è¥å·¥å…·"åˆ†ç±»
   - æ‰¾åˆ°"å•†å®¶å›å¤è§£ç­”æ‰‹å†Œ"

2. **ç‚¹å‡»"æ‰“å¼€å·¥å…·"æŒ‰é’®**ï¼š
   - âœ… åº”è¯¥åœ¨Tauriåº”ç”¨å†…çš„WebViewæ¨¡æ€æ¡†ä¸­æ‰“å¼€
   - âœ… ä¸åº”è¯¥æ‰“å¼€æµè§ˆå™¨

## ğŸ”„ æ·»åŠ æ–°çš„å¤–éƒ¨å·¥å…·

å¦‚æœéœ€è¦å°†å…¶ä»–å·¥å…·ä¹Ÿè®¾ç½®ä¸ºå¤–éƒ¨æ‰“å¼€ï¼š

### æ­¥éª¤1: ä¿®æ”¹å·¥å…·æ•°æ®

```typescript
// lib/tool-data.ts
{
  id: XX,
  name: "å·¥å…·åç§°",
  // ... å…¶ä»–é…ç½® ...
  toolType: "external"  // æ”¹ä¸º external
}
```

### æ­¥éª¤2: æ·»åŠ æƒé™ï¼ˆå¦‚æœæ˜¯æ–°åŸŸåï¼‰

```json
// src-tauri/capabilities/main-capability.json
{
  "validator": "https://æ–°åŸŸå.com/**"
}
```

### æ­¥éª¤3: é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
npm run tauri:dev
```

### æ­¥éª¤4: æµ‹è¯•éªŒè¯

æŒ‰ç…§ä¸Šè¿°æµ‹è¯•æ­¥éª¤éªŒè¯åŠŸèƒ½ã€‚

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç‚¹å‡»å·¥å…·åæ²¡æœ‰ååº”

**æ£€æŸ¥é¡¹**ï¼š
1. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼ŒæŸ¥çœ‹ `å·¥å…·ç±»å‹:` è¾“å‡º
2. ç¡®è®¤ `toolType` è®¾ç½®æ­£ç¡®
3. æ£€æŸ¥Tauriæƒé™é…ç½®ä¸­æ˜¯å¦åŒ…å«è¯¥URL

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
# åº”è¯¥çœ‹åˆ°: ğŸŒ [å‰ç«¯] åœ¨å¤–éƒ¨æµè§ˆå™¨ä¸­æ‰“å¼€: https://...
```

### Q2: æƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
shell:allow-open permission denied
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `main-capability.json` ä¸­çš„ `shell:allow-open` é…ç½®
2. ç¡®ä¿URLåŒ¹é… validator æ¨¡å¼
3. é‡å¯Tauriå¼€å‘æœåŠ¡å™¨

### Q3: åœ¨Webç¯å¢ƒä¸­æ— æ³•æ‰“å¼€

**ç°è±¡**: åœ¨ `npm run dev` (éTauri) ä¸­ç‚¹å‡»æ— ååº”

**åŸå› **: Webç¯å¢ƒä½¿ç”¨ `window.open`ï¼Œå¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢å¼¹çª—

**è§£å†³æ–¹æ¡ˆ**:
- å…è®¸æµè§ˆå™¨å¼¹å‡ºçª—å£
- æˆ–è€…åœ¨Tauriç¯å¢ƒä¸­æµ‹è¯•ï¼ˆæ¨èï¼‰

## ğŸ“ æœ€ä½³å®è·µ

### ä½•æ—¶ä½¿ç”¨ `external`

```typescript
// âœ… æ¨èä½¿ç”¨ external
toolType: "external"  // å½“å·¥å…·åŒ…å«ä»¥ä¸‹åŠŸèƒ½æ—¶
```

**æ ‡å‡†**ï¼š
- âœ… éœ€è¦æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- âœ… ä½¿ç”¨ `<input type="file">`
- âœ… ä½¿ç”¨ `fetch()` è®¿é—®è·¨åŸŸèµ„æº
- âœ… ä¾èµ–æµè§ˆå™¨ç‰¹å®šAPI
- âœ… éœ€è¦OAuthè®¤è¯

### ä½•æ—¶ä½¿ç”¨ `web`

```typescript
// âœ… æ¨èä½¿ç”¨ web
toolType: "web"  // å½“å·¥å…·æ˜¯ä»¥ä¸‹ç±»å‹æ—¶
```

**æ ‡å‡†**ï¼š
- âœ… çº¯å±•ç¤ºå†…å®¹ï¼ˆæ‰‹å†Œã€æ–‡æ¡£ï¼‰
- âœ… æ•°æ®å¯è§†åŒ–ï¼ˆå›¾è¡¨ã€ç»Ÿè®¡ï¼‰
- âœ… ç®€å•è®¡ç®—å™¨/å·¥å…·
- âœ… ä¸éœ€è¦æ–‡ä»¶æ“ä½œ
- âœ… ä¸éœ€è¦è·¨åŸŸè¯·æ±‚

## ğŸ” å®‰å…¨è€ƒè™‘

### URLç™½åå•

å½“å‰é…ç½®å…è®¸æ‰“å¼€æ‰€æœ‰ `https://` å’Œ `http://` é“¾æ¥ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ï¼š

1. **ä»…å…è®¸ç‰¹å®šåŸŸå**ï¼š
   ```json
   {
     "validator": "https://xuxikai886.github.io/**"
   }
   ```

2. **é¿å…é€šé…ç¬¦**ï¼š
   ```json
   // âŒ ä¸æ¨è
   { "validator": "https://**" }

   // âœ… æ¨è
   { "validator": "https://trusted-domain.com/**" }
   ```

3. **å®šæœŸå®¡æŸ¥**ï¼š
   - æ£€æŸ¥é…ç½®çš„URLåˆ—è¡¨
   - ç§»é™¤ä¸å†ä½¿ç”¨çš„æƒé™
   - ç¡®ä¿åªæœ‰å¯ä¿¡æ¥æº

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Tauri Shell Plugin](https://v2.tauri.app/plugin/shell/)
- [Tauri Capabilities](https://v2.tauri.app/learn/security/capabilities/)
- [å·¥å…·æ•°æ®é…ç½®](../lib/tool-data.ts)
- [å·¥å…·ç½‘æ ¼ç»„ä»¶](../components/tool-grid.tsx)

---

**åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ16æ—¥
**ç‰ˆæœ¬**: v1.0.26+
**çŠ¶æ€**: âœ… å·²å®ç°å¹¶æµ‹è¯•
